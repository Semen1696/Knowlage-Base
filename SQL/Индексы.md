# Индексы

Одним из важнейших путей достижения высокой производительности SQL Server является использование индексов. Индекс ускоряет процесс запроса, 
предоставляя быстрый доступ к строкам данных в таблице, аналогично тому, как указатель в книге помогает вам быстро найти необходимую информацию. 

## Структура

Индексы создаются для столбцов таблиц и представлений. Индексы предоставляют путь для быстрого поиска данных на основе значений в этих столбцах. 
Например, если вы создадите индекс по первичному ключу, а затем будете искать строку с данными, используя значения первичного ключа, 
то SQL Server сначала найдет значение индекса, а затем использует индекс для быстрого нахождения всей строки с данными. Без индекса будет выполнен 
полный просмотр (сканирование) всех строк таблицы, что может оказать значительное влияние на производительность.

Индекс состоит из набора страниц, узлов индекса, которые организованы в виде древовидной структуры — сбалансированного дерева. 
Эта структура является иерархической по своей природе и начинается с корневого узла на вершине иерархии и конечных узлов, листьев, в нижней части

## Кластеризированый индекс

Кластеризованный индекс хранит реальные строки данных в листьях индекса. 
Возвращаясь к предыдущему примеру, это означает что строка данных, связанная со значением ключа, равного 123 будет храниться в самом индексе. 
Важной характеристикой кластеризованного индекса является то, что все значения отсортированы в определенном порядке либо возрастания, либо убывания. 
Таким образом, таблица или представление может иметь только один кластеризованный индекс. 
В дополнение следует отметить, что данные в таблице хранятся в отсортированном виде только в случае если создан кластеризованный индекс у этой таблицы.
Таблица не имеющая кластеризованного индекса называется кучей.

## Некластеризованный индекс

В отличие от кластеризованного индекса, листья некластеризованного индекса содержат только те столбцы (ключевые), 
по которым определен данный индекс, а также содержит указатель на строки с реальными данными в таблице. 
Это означает, что системе подзапросов необходима дополнительная операция для обнаружения и получения требуемых данных.

Содержание указателя на данные зависит от способа хранения данных: кластеризованная таблица или куча. 
Если указатель ссылается на кластеризованную таблицу, то он ведет к кластеризованному индексу, используя который можно найти реальные данные.
Если указатель ссылается на кучу, то он ведет к конкретному идентификатору строки с данными.

екластеризованные индексы не могут быть отсортированы в отличие от кластеризованных, 
однако вы можете создать более одного некластеризованного индекса на таблице или представлении, вплоть до 999.

## Типы индексов

1) Составной
2) Уникальный
3) Покрывающий

### Составной индекс

Такой индекс может содержать более одного столбца. Вы можете включить до 16 столбцов в индекс, но их общая длина ограничена 900 байтами. 
Как кластеризованный, так и некластеризованный индексы могут быть составными.

### Уникальный индекс

акой индекс обеспечивает уникальность каждого значения в индексируемом столбце. 
Если индекс составной, то уникальность распространяется на все столбцы индекса, но не на каждый отдельный столбец.

Уникальный индекс автоматически создается когда вы определяете ограничения столбца: первичный ключ или ограничение на уникальность значений:

1) Первичный ключ
Когда вы определяете ограничение первичного ключа на один или несколько столбцов, тогда SQL Server автоматически создаёт 
уникальный кластеризованный индекс, если кластеризованный индекс не был создан ранее

2) Уникальность значений
Когда вы определяете ограничение на уникальность значений, тогда SQL Server автоматически создает уникальный некластеризованный индекс. 
Вы можете указать, чтобы был создан уникальный кластеризованный индекс, если кластеризованного индекса до сих пор не было создано на таблице


### Покрывающий индекс

Такой индекс позволяет конкретному запросу сразу получить все необходимые данные с листьев индекса без дополнительных обращений к записям самой таблицы.

## Почему таблица не может иметь два кластеризованных индекса

Кластеризованный индекс – это и есть таблица. 
Когда вы создаете кластеризованный индекс у таблицы, подсистема хранения данных сортирует все строки в таблице в порядке возрастания или убывания, 
согласно определению индекса. Кластеризованный индекс это не отдельная сущность как другие индексы, 
а механизм сортировки данных в таблице и облегчения быстрого доступа к строкам с данными.
